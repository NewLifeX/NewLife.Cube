# 第18章 自定义导航与布局

> 本章介绍如何自定义魔方的导航栏和页面布局。

---

## 18.1 _Layout.cshtml 布局页

### 布局结构

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewBag.Title - 魔方管理系统</title>
    
    @RenderSection("Styles", required: false)
</head>
<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <!-- 顶部导航 -->
        @Html.Partial("_Layout_Header")
        
        <!-- 左侧菜单 -->
        @Html.Partial("_Left")
        
        <!-- 主内容区 -->
        <div class="content-wrapper">
            @RenderBody()
        </div>
        
        <!-- 底部 -->
        @Html.Partial("_Layout_Footer")
    </div>
    
    @RenderSection("Scripts", required: false)
</body>
</html>
```

### 覆写布局

创建 `Areas/Admin/Views/Shared/_Layout.cshtml` 覆写默认布局。

---

## 18.2 顶部导航栏（_Layout_Header）

```html
<nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- 左侧菜单按钮 -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#">
                <i class="fas fa-bars"></i>
            </a>
        </li>
    </ul>
    
    <!-- 右侧用户信息 -->
    <ul class="navbar-nav ml-auto">
        <!-- 通知 -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="far fa-bell"></i>
                <span class="badge badge-warning navbar-badge">@ViewBag.NotifyCount</span>
            </a>
        </li>
        
        <!-- 用户菜单 -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="far fa-user"></i> @User.Identity.Name
            </a>
            <div class="dropdown-menu dropdown-menu-right">
                <a href="/Admin/User/Info" class="dropdown-item">个人信息</a>
                <a href="/Admin/User/Password" class="dropdown-item">修改密码</a>
                <div class="dropdown-divider"></div>
                <a href="/Admin/User/Logout" class="dropdown-item">退出登录</a>
            </div>
        </li>
    </ul>
</nav>
```

---

## 18.3 左侧菜单栏（_Left）

```html
<aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Logo -->
    <a href="/" class="brand-link">
        <img src="~/images/logo.png" class="brand-image" />
        <span class="brand-text font-weight-light">魔方管理系统</span>
    </a>
    
    <!-- 菜单 -->
    <div class="sidebar">
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview">
                @foreach (var menu in ViewBag.Menus)
                {
                    @await Html.PartialAsync("_MenuItem", menu)
                }
            </ul>
        </nav>
    </div>
</aside>
```

### 菜单项模板（_MenuItem）

```html
@model Menu
@{
    var hasChildren = Model.Childs?.Count > 0;
    var isActive = ViewBag.CurrentMenu?.Id == Model.Id;
}

<li class="nav-item @(hasChildren ? "has-treeview" : "") @(isActive ? "menu-open" : "")">
    <a href="@(hasChildren ? "#" : Model.Url)" class="nav-link @(isActive ? "active" : "")">
        <i class="nav-icon @Model.Icon"></i>
        <p>
            @Model.DisplayName
            @if (hasChildren)
            {
                <i class="right fas fa-angle-left"></i>
            }
        </p>
    </a>
    @if (hasChildren)
    {
        <ul class="nav nav-treeview">
            @foreach (var child in Model.Childs)
            {
                @await Html.PartialAsync("_MenuItem", child)
            }
        </ul>
    }
</li>
```

---

## 18.4 面包屑导航

```html
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>@ViewBag.Title</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="/">首页</a></li>
                    @if (ViewBag.ParentMenu != null)
                    {
                        <li class="breadcrumb-item">@ViewBag.ParentMenu.DisplayName</li>
                    }
                    <li class="breadcrumb-item active">@ViewBag.Title</li>
                </ol>
            </div>
        </div>
    </div>
</section>
```

---

## 18.5 响应式布局配置

### 移动端适配

```css
/* 移动端样式 */
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
    }
    
    .sidebar-open .sidebar {
        transform: translateX(0);
    }
    
    .content-wrapper {
        margin-left: 0 !important;
    }
}
```

### 布局模式切换

```javascript
// 固定侧边栏
$('body').addClass('sidebar-mini layout-fixed');

// 折叠侧边栏
$('body').addClass('sidebar-collapse');

// 顶部导航模式
$('body').addClass('layout-top-nav');
```

---

## 本章小结

通过本章学习，你应该掌握了：

1. **布局页结构**：_Layout.cshtml 的组成
2. **导航栏定制**：顶部和左侧导航
3. **菜单渲染**：树形菜单的实现
4. **面包屑导航**：页面导航路径
5. **响应式布局**：移动端适配

---
