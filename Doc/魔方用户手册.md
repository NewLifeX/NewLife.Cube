# 魔方用户手册

> **适用对象**：基于魔方开发的应用系统的最终用户和管理员  
> **在线教程**：https://newlifex.com/cube  
> **演示站点**：https://cube.newlifex.com  
> **用户中心**：https://sso.newlifex.com

本手册面向使用基于魔方快速开发平台构建的应用系统的最终用户和管理员，介绍系统的通用功能和日常操作。所有基于魔方二次开发的系统都具备这些基础功能，您可以通过本手册快速掌握系统的使用方法。

---

## 第1章 系统概览

### 1.1 登录系统

#### 1.1.1 用户名密码登录

1. 在浏览器中打开系统地址，将显示登录页面
2. 输入用户名和密码
3. 如系统启用验证码，需要输入图形验证码
4. 点击"登录"按钮进入系统

**默认管理员账号**：
- 首个进入系统的用户将自动成为管理员
- 系统内置的 `admin` 账号在首个用户登录后将被禁用

**注意事项**：
- 密码区分大小写
- 连续多次输入错误密码可能导致账号被临时锁定
- 建议使用强密码，包含大小写字母、数字和特殊字符

#### 1.1.2 第三方账号登录

系统支持多种第三方账号登录方式（需管理员在后台配置）：
- 微信登录
- QQ登录
- 钉钉登录
- GitHub登录
- 企业微信登录
- 支付宝登录
- 其它OAuth服务提供商

**使用步骤**：
1. 在登录页面点击对应的第三方登录图标
2. 跳转到第三方平台完成授权
3. 授权成功后自动返回系统
4. 首次使用可能需要绑定系统账号

#### 1.1.3 忘记密码与重置

如果忘记密码，请联系系统管理员进行密码重置。管理员可以在用户管理功能中为您重置密码。

---

### 1.2 首页与导航

登录成功后，您将看到系统的主界面，包含以下几个主要区域：

#### 1.2.1 顶部导航栏

位于页面顶部，显示：
- 系统名称和Logo
- 快捷功能入口
- 个人信息下拉菜单
  - 个人设置
  - 修改密码
  - 退出登录

#### 1.2.2 左侧菜单栏

位于页面左侧，显示您有权限访问的功能菜单：
- 菜单采用树形结构组织
- 点击菜单项展开/收起子菜单
- 点击具体功能进入对应页面
- 菜单项前的图标帮助快速识别功能

**菜单操作**：
- 单击一级菜单：展开/收起子菜单
- 单击功能菜单：打开对应功能页面
- 当前选中的菜单项会高亮显示

#### 1.2.3 面包屑导航

位于页面内容区域顶部，显示当前所在位置的层级路径：
- 首页 > 一级菜单 > 二级菜单 > 当前页面
- 点击面包屑中的任一层级可快速返回
- 帮助您了解当前所在功能位置

---

### 1.3 个人设置

#### 1.3.1 修改密码

**步骤**：
1. 点击顶部右上角的用户名
2. 在下拉菜单中选择"修改密码"
3. 输入当前密码
4. 输入新密码
5. 再次输入新密码确认
6. 点击"保存"按钮

**密码要求**：
- 长度通常不少于6位（具体要求由管理员配置）
- 建议包含大小写字母、数字和特殊字符
- 新密码不能与旧密码相同

#### 1.3.2 个人信息维护

在个人设置中可以维护以下信息：
- 姓名
- 昵称
- 手机号码
- 邮箱地址
- 个人简介
- 其它扩展信息

**修改步骤**：
1. 点击"个人设置"进入个人信息页面
2. 修改需要更新的信息
3. 点击"保存"按钮提交修改

#### 1.3.3 头像设置

设置个人头像，让界面更加个性化：
1. 进入个人设置页面
2. 点击头像区域的"上传"或"更换"按钮
3. 选择本地图片文件（支持jpg、png格式）
4. 可能需要裁剪调整图片
5. 确认后保存

---

## 第2章 数据管理基础

### 2.1 列表页操作

列表页是系统中最常见的页面类型，用于展示和管理数据。

#### 2.1.1 数据浏览与分页

**列表区域**：
- 表格形式展示数据
- 每行代表一条记录
- 列头显示字段名称
- 底部显示分页控件

**分页操作**：
- 显示当前页码和总页数
- 点击页码跳转到指定页
- 点击"上一页"/"下一页"翻页
- 可以设置每页显示条数（如10条、20条、50条、100条）
- 底部显示总记录数

#### 2.1.2 排序与筛选

**排序**：
- 点击列头可对该列进行排序
- 再次点击切换升序/降序
- 排序列会显示排序方向箭头

**筛选**：
- 部分列头可能包含筛选图标
- 点击可选择筛选条件
- 筛选后列表自动刷新

#### 2.1.3 搜索与高级查询

**快速搜索**：
- 列表顶部通常有搜索框
- 输入关键字后点击"搜索"按钮
- 系统在多个字段中查找匹配记录

**高级查询**：
- 点击"高级查询"或"展开查询"按钮
- 显示更多查询条件
- 可以组合多个条件精确查找
- 支持的查询条件包括：
  - 文本字段：等于、包含、开头、结尾
  - 数字字段：等于、大于、小于、范围
  - 日期字段：等于、之前、之后、范围
  - 下拉选择：单选、多选

**查询操作**：
1. 填写查询条件
2. 点击"查询"按钮执行搜索
3. 点击"重置"按钮清空条件
4. 查询结果在列表区域显示

#### 2.1.4 日期范围选择

日期查询通常提供便捷的日期范围选择：
- **快捷选项**：今天、昨天、最近7天、最近30天、本月、上月
- **自定义范围**：选择开始日期和结束日期
- **日期选择器**：
  - 点击日期输入框弹出日历
  - 选择日期后自动填入
  - 可以手动输入日期
  - 支持清空日期

---

### 2.2 数据的增删改查

#### 2.2.1 添加数据

**步骤**：
1. 在列表页点击"添加"或"新增"按钮
2. 系统打开添加表单页面
3. 填写必填字段（通常标有红色星号*）
4. 填写其它可选字段
5. 点击"保存"按钮提交
6. 保存成功后返回列表页

**注意事项**：
- 必填字段不能为空
- 某些字段可能有格式要求（如邮箱、手机号）
- 某些字段可能有唯一性要求（如用户名）
- 填写错误时会显示红色错误提示
- 可点击"取消"按钮放弃添加

#### 2.2.2 编辑数据

**步骤**：
1. 在列表中找到要修改的记录
2. 点击该行的"编辑"按钮
3. 系统打开编辑表单，显示当前数据
4. 修改需要更改的字段
5. 点击"保存"按钮提交
6. 保存成功后返回列表页

**提示**：
- 某些字段可能不允许修改（显示为灰色或只读）
- 修改会记录在操作日志中
- 部分系统可能显示修改前后的对比

#### 2.2.3 删除数据

**单条删除**：
1. 在列表中找到要删除的记录
2. 点击该行的"删除"按钮
3. 系统弹出确认对话框
4. 确认后数据被删除

**批量删除**：
1. 勾选列表中要删除的多条记录
2. 点击工具栏的"批量删除"按钮
3. 系统弹出确认对话框
4. 确认后所有选中的数据被删除

**注意**：
- 删除操作通常不可恢复，请谨慎操作
- 某些被其它数据引用的记录可能无法删除
- 删除操作会记录在操作日志中
- 部分系统采用软删除（标记为已删除但不真正删除）

#### 2.2.4 查看详情

**步骤**：
1. 在列表中找到要查看的记录
2. 点击该行的"详情"或"查看"按钮
3. 系统打开详情页面，显示完整信息
4. 详情页通常以只读方式展示数据
5. 可以从详情页直接跳转到编辑页面

**详情页特点**：
- 显示所有字段信息，包括列表中未显示的字段
- 可能显示关联数据
- 可能显示操作历史
- 通常提供"编辑"、"删除"等快捷操作按钮

---

### 2.3 批量操作

批量操作可以同时对多条记录执行相同的操作，提高工作效率。

#### 2.3.1 批量启用/禁用

**适用场景**：需要同时启用或禁用多条记录

**步骤**：
1. 在列表页勾选要操作的记录
2. 点击工具栏的"批量启用"或"批量禁用"按钮
3. 系统弹出确认对话框，显示将要操作的记录数量
4. 确认后批量执行操作
5. 操作结果会在列表中更新

#### 2.3.2 批量删除

详见 [2.2.3 删除数据](#223-删除数据) 中的批量删除部分。

#### 2.3.3 全选与反选

**全选**：
- 点击列表表头的复选框
- 当前页的所有记录被选中
- 再次点击取消全选

**反选**：
- 部分系统提供"反选"按钮
- 点击后，已选中的变为未选中，未选中的变为选中

**跨页选择**：
- 基础功能通常只支持当前页选择
- 部分系统支持"选择全部记录"功能

---

## 第3章 数据导入导出

### 3.1 数据导出

数据导出功能可以将列表数据保存为本地文件，方便进一步处理或备份。

#### 3.1.1 导出为Excel

**步骤**：
1. 在列表页执行查询，得到需要导出的数据
2. 点击"导出"按钮，选择"导出Excel"
3. 浏览器自动下载Excel文件
4. 使用Excel软件打开查看

**特点**：
- 支持格式化显示（如日期、数字）
- 保留列头信息
- 可以在Excel中进一步编辑和分析

#### 3.1.2 导出为CSV

**步骤**：
1. 在列表页点击"导出"按钮
2. 选择"导出CSV"
3. 下载CSV文件

**特点**：
- 纯文本格式，文件较小
- 兼容性好，可被多种软件打开
- 适合大批量数据导出
- 可以导入到其它系统

#### 3.1.3 导出为JSON / XML

**用途**：主要用于系统对接或数据交换

**JSON格式**：
- 轻量级数据格式
- 适合程序处理
- 保留完整的数据结构

**XML格式**：
- 标准化数据格式
- 适合跨平台数据交换
- 包含完整的结构信息

#### 3.1.4 导出当前页 vs 导出全部

**导出当前页**：
- 只导出当前页面显示的记录
- 速度快
- 适合少量数据

**导出全部**：
- 导出所有符合查询条件的记录
- 可能需要较长时间
- 系统可能限制导出的最大记录数
- 大数据量导出可能分批下载

**提示**：
- 导出前先设置好查询条件
- 导出会包含当前选择显示的列
- 某些敏感字段可能不允许导出
- 导出操作可能被记录在日志中

---

### 3.2 数据导入

数据导入功能可以批量添加或更新数据，适合初始化数据或批量维护。

#### 3.2.1 导入模板下载

**步骤**：
1. 在列表页点击"导入"按钮
2. 点击"下载导入模板"链接
3. 系统下载Excel模板文件
4. 模板包含所有可导入的字段列

**模板说明**：
- 第一行为列头（字段名称）
- 必填字段通常在列头标注
- 可能包含字段说明或示例数据
- 不要修改列头行

#### 3.2.2 Excel数据导入

**步骤**：
1. 使用下载的模板填写数据
2. 填写完成后保存Excel文件
3. 在系统中点击"导入"按钮
4. 点击"选择文件"按钮，选择准备好的Excel文件
5. 点击"上传"或"导入"按钮
6. 系统开始解析和导入数据
7. 导入完成后显示结果报告

**注意事项**：
- 确保数据格式正确（如日期、数字格式）
- 必填字段不能为空
- 唯一性字段不能重复
- 建议先小批量测试，确认无误后再大批量导入

#### 3.2.3 导入错误处理

导入过程中可能出现的错误：

**格式错误**：
- 日期格式不正确
- 数字格式错误
- 超出字段长度限制

**业务错误**：
- 必填字段为空
- 唯一性字段重复
- 引用的关联数据不存在
- 不符合业务规则

**错误报告**：
- 系统会显示错误的行号和错误原因
- 可以下载错误报告文件
- 修正错误后可重新导入

**处理建议**：
- 导出错误记录，单独修正
- 已成功导入的记录不会重复导入
- 可以分批导入，减少单次错误影响

---

### 3.3 数据分享

数据分享功能可以将查询结果生成分享链接，供他人查看。

#### 3.3.1 分享链接生成

**步骤**：
1. 在列表页设置好查询条件
2. 点击"分享"按钮
3. 系统生成分享链接
4. 复制链接发送给其他人

**分享链接特点**：
- 包含当前的查询条件
- 包含列显示设置
- 接收者打开链接即可查看数据

#### 3.3.2 分享权限设置

**权限控制**：
- 可以设置分享链接的有效期
- 可以设置是否需要登录才能查看
- 可以限制查看权限（只读）
- 可以随时撤销分享链接

**注意**：
- 不要分享包含敏感数据的链接
- 及时清理过期的分享链接
- 分享操作可能被记录在日志中

---

## 第4章 用户与权限管理

### 4.1 用户管理

用户管理功能用于维护系统使用者的账号信息。

#### 4.1.1 用户列表查看

在用户管理页面可以查看：
- 用户名
- 姓名/昵称
- 手机号
- 邮箱
- 所属角色
- 最后登录时间
- 启用/禁用状态

**查询条件**：
- 按用户名搜索
- 按姓名搜索
- 按角色筛选
- 按启用状态筛选
- 按登录时间范围查询

#### 4.1.2 添加新用户

**步骤**：
1. 点击"添加用户"按钮
2. 填写用户信息：
   - **用户名**（必填，登录账号，不能重复）
   - **姓名**（必填）
   - **密码**（必填，首次登录密码）
   - **手机号**（可选，建议填写）
   - **邮箱**（可选）
   - **所属角色**（必填，决定用户权限）
   - **是否启用**（默认启用）
3. 点击"保存"按钮

**注意**：
- 用户名一旦创建不能修改
- 建议为新用户设置临时密码，提醒其首次登录后修改
- 正确分配角色，避免权限过大或过小

#### 4.1.3 编辑用户信息

可以修改的信息：
- 姓名
- 昵称
- 手机号
- 邮箱
- 所属角色
- 启用/禁用状态

**不能修改的信息**：
- 用户名（系统唯一标识）

#### 4.1.4 启用/禁用用户

**禁用用户**：
- 禁用后用户无法登录系统
- 已登录的会话不会立即失效
- 用户数据保留，可以随时重新启用

**启用用户**：
- 启用后用户可以正常登录
- 恢复之前的权限设置

**应用场景**：
- 员工离职：禁用账号
- 临时休假：禁用账号，回来后启用
- 账号异常：暂时禁用，调查后处理

#### 4.1.5 重置用户密码

**步骤**：
1. 在用户列表中找到目标用户
2. 点击"重置密码"按钮
3. 系统将密码重置为默认密码或随机密码
4. 将新密码告知用户
5. 提醒用户登录后立即修改密码

**安全建议**：
- 不要在公开场合传递密码
- 建议用户首次登录后强制修改密码
- 定期提醒用户更新密码

---

### 4.2 角色管理

角色是权限的集合，将用户分配到不同角色，可以批量管理权限。

#### 4.2.1 角色列表

角色列表显示：
- 角色名称
- 角色说明
- 包含的用户数量
- 权限配置状态
- 是否启用

**系统内置角色**：
- 管理员：拥有所有权限
- 可能还有其它预设角色

#### 4.2.2 创建角色

**步骤**：
1. 点击"添加角色"按钮
2. 填写角色信息：
   - **角色名称**（必填）
   - **角色说明**（可选，描述该角色的职责）
   - **是否启用**（默认启用）
3. 点击"保存"按钮
4. 创建成功后配置角色权限

**角色命名建议**：
- 使用业务术语，如"销售员"、"财务主管"
- 避免使用技术术语
- 名称要简洁明了

#### 4.2.3 角色权限配置

**步骤**：
1. 在角色列表中点击"权限配置"按钮
2. 系统显示菜单权限树
3. 勾选该角色可以访问的菜单
4. 展开菜单，勾选具体的操作权限：
   - 查看（查询列表、查看详情）
   - 添加（新增数据）
   - 编辑（修改数据）
   - 删除（删除数据）
   - 其它自定义操作
5. 点击"保存"按钮

**权限配置原则**：
- 最小权限原则：只授予必需的权限
- 职责分离：不同角色负责不同功能
- 定期审核：定期检查角色权限是否合理

---

### 4.3 权限理解

#### 4.3.1 权限模型说明

魔方采用**四级权限模型**：

```
用户 → 角色 → 菜单 → 操作(Action)
```

**层级关系**：
1. **用户**：系统使用者
2. **角色**：用户的权限集合，一个用户可以有多个角色
3. **菜单**：功能模块的入口
4. **操作**：菜单下的具体功能（如查看、添加、编辑、删除）

**权限判断流程**：
1. 用户登录后，系统加载该用户的所有角色
2. 汇总所有角色的权限（取并集）
3. 用户访问功能时，检查是否有对应的菜单和操作权限
4. 有权限则允许访问，无权限则提示或隐藏

#### 4.3.2 常见权限项解释

**菜单权限**：
- 控制用户是否能看到该菜单项
- 无权限的菜单不会在导航中显示

**查看权限**：
- 控制是否能查看列表
- 控制是否能查看详情
- 最基础的权限，通常都需要授予

**添加权限**：
- 控制是否能看到"添加"按钮
- 控制是否能提交添加表单

**编辑权限**：
- 控制是否能看到"编辑"按钮
- 控制是否能修改数据

**删除权限**：
- 控制是否能看到"删除"按钮
- 控制是否能执行删除操作
- 删除权限通常较为敏感，谨慎授予

**自定义操作权限**：
- 审核、导出、导入等特殊功能
- 按实际业务需要授予

**权限组合示例**：
- **查询员**：只有查看权限
- **操作员**：查看 + 添加 + 编辑
- **管理员**：所有权限

---

## 第5章 系统管理

### 5.1 菜单管理

菜单管理功能用于配置系统的导航菜单结构。

#### 5.1.1 菜单结构查看

菜单以树形结构显示：
- **一级菜单**：主功能模块
- **二级菜单**：具体功能页面
- **三级菜单**：更细分的功能

**查看方式**：
- 树形展示，点击节点展开/收起
- 显示菜单层级关系
- 显示菜单的各项属性

#### 5.1.2 菜单图标与排序

**菜单图标**：
- 每个菜单可以设置图标
- 图标帮助用户快速识别功能
- 支持常见的图标库（如FontAwesome）

**菜单排序**：
- 通过"排序"字段控制显示顺序
- 数字越小越靠前
- 同级菜单按排序号从小到大显示

**修改方式**：
1. 点击菜单的"编辑"按钮
2. 修改"图标"或"排序"字段
3. 保存后立即生效

#### 5.1.3 菜单可见性

**显示/隐藏控制**：
- 可见菜单：在导航中显示
- 隐藏菜单：不在导航中显示，但仍可通过直接访问链接使用
- 禁用菜单：完全不可访问

**应用场景**：
- 隐藏内部管理功能
- 临时下线某功能
- 隐藏但保留权限控制

---

### 5.2 系统设置

系统设置用于配置系统的全局参数。

#### 5.2.1 基础设置

**系统名称**：
- 显示在页面顶部和标题栏
- 建议使用简短、易识别的名称

**系统Logo**：
- 显示在登录页和导航栏
- 支持上传自定义Logo图片

**首页地址**：
- 登录后默认跳转的页面

**其它基础配置**：
- 系统版本号
- 版权信息
- 联系方式

#### 5.2.2 登录设置

**登录策略**：
- 密码复杂度要求
- 密码有效期
- 登录失败锁定策略（失败次数、锁定时长）
- 是否启用验证码

**会话设置**：
- 会话超时时间
- 是否允许多地同时登录

**第三方登录**：
- 启用/禁用第三方登录
- 配置OAuth应用

#### 5.2.3 界面设置

**主题选择**：
- 可选择不同的界面主题
- 如AdminLTE、Metronic等

**语言设置**：
- 系统界面语言
- 日期时间格式

**布局设置**：
- 菜单展开/收起默认状态
- 列表页默认显示条数

---

### 5.3 参数字典

参数字典用于配置系统中的各种枚举值和配置参数。

#### 5.3.1 字典项查看

字典项通常分类组织：
- 字典分类（如"用户类型"、"订单状态"）
- 字典项（具体的枚举值）
- 字典值（对应的代码值）
- 排序号

**查看方式**：
- 按分类浏览
- 搜索字典名称

#### 5.3.2 字典值配置

管理员可以添加、修改、删除字典项：

**添加字典项**：
1. 选择字典分类
2. 点击"添加"按钮
3. 填写字典项名称、值、排序号
4. 保存

**修改字典项**：
- 可以修改显示名称
- 可以修改排序
- 谨慎修改字典值（可能影响已有数据）

**删除字典项**：
- 删除前检查是否被使用
- 被使用的字典项建议禁用而不是删除

---

## 第6章 日志与监控

### 6.1 操作日志

操作日志记录用户在系统中的重要操作，用于审计和问题追溯。

#### 6.1.1 查看操作记录

日志列表显示：
- 操作时间
- 操作用户
- 操作类型（登录、添加、修改、删除等）
- 操作对象（模块名称、数据ID）
- 操作结果（成功/失败）
- 详细信息
- IP地址

#### 6.1.2 日志筛选与查询

**查询条件**：
- 时间范围：今天、最近7天、自定义时间段
- 操作用户：选择或输入用户名
- 操作类型：登录、添加、修改、删除等
- 操作对象：选择功能模块
- 关键字：在详细信息中搜索

**导出日志**：
- 可以将查询结果导出为Excel
- 用于离线分析或归档

---

### 6.2 用户在线

用户在线功能显示当前登录系统的用户信息。

#### 6.2.1 当前在线用户

在线用户列表显示：
- 用户名
- 姓名
- 登录时间
- 最后活动时间
- IP地址
- 浏览器信息
- 会话状态

**刷新**：
- 列表通常不自动刷新
- 点击"刷新"按钮获取最新状态

#### 6.2.2 用户会话管理

管理员可以管理用户会话：

**查看会话详情**：
- 会话ID
- 登录位置
- 活动历史

**强制下线**：
1. 选择要下线的用户
2. 点击"强制下线"按钮
3. 确认后该用户会话被终止
4. 用户需要重新登录

**应用场景**：
- 发现异常登录
- 用户账号被盗用
- 需要立即终止某用户的访问

---

### 6.3 访问统计

访问统计功能提供系统使用情况的统计分析。

#### 6.3.1 访问量统计

**统计维度**：
- 按日期统计：每日访问量趋势
- 按小时统计：一天中的访问分布
- 按用户统计：用户活跃度排名
- 按功能统计：各功能模块的使用频率
- 按IP统计：访问来源分析

**图表展示**：
- 折线图：趋势分析
- 柱状图：对比分析
- 饼图：占比分析

#### 6.3.2 用户活跃度

**活跃度指标**：
- 日活跃用户数（DAU）
- 周活跃用户数（WAU）
- 月活跃用户数（MAU）
- 平均在线时长
- 操作频次

**用户行为分析**：
- 常用功能
- 访问路径
- 活跃时段

---

## 第7章 常见操作FAQ

### 7.1 如何修改登录密码？

**方法一：通过个人设置**
1. 登录系统后，点击右上角用户名
2. 选择"修改密码"
3. 输入当前密码和新密码
4. 保存

**方法二：通过个人信息页**
1. 点击"个人设置"
2. 找到"修改密码"区域
3. 按提示操作

详见 [1.3.1 修改密码](#131-修改密码)

---

### 7.2 如何批量导出数据？

**步骤**：
1. 在列表页设置查询条件，筛选出需要导出的数据
2. 点击"导出"按钮
3. 选择导出格式（Excel、CSV等）
4. 选择"导出全部"（而不是"导出当前页"）
5. 等待下载完成

**注意**：
- 大量数据导出可能需要较长时间
- 系统可能限制单次导出的最大记录数
- 某些敏感字段可能不允许导出

详见 [第3章 数据导入导出](#第3章-数据导入导出)

---

### 7.3 如何给用户分配权限？

**方法一：通过角色分配（推荐）**
1. 进入"角色管理"
2. 为角色配置权限
3. 在"用户管理"中将用户分配到该角色

**方法二：直接编辑用户**
1. 进入"用户管理"
2. 编辑目标用户
3. 在"所属角色"中选择角色
4. 保存

详见 [第4章 用户与权限管理](#第4章-用户与权限管理)

---

### 7.4 如何查看操作日志？

1. 在左侧菜单找到"系统管理"或"日志管理"
2. 点击"操作日志"
3. 设置查询条件（时间、用户、操作类型等）
4. 点击"查询"按钮
5. 在列表中查看日志详情

详见 [6.1 操作日志](#61-操作日志)

---

### 7.5 系统显示无权限怎么办？

**情况一：菜单不显示**
- 原因：当前用户没有该菜单的访问权限
- 解决：联系管理员分配权限

**情况二：功能按钮不显示（如"添加"、"删除"按钮）**
- 原因：有菜单权限但无操作权限
- 解决：联系管理员授予对应的操作权限

**情况三：页面显示"无权限"提示**
- 原因：直接访问URL但没有权限
- 解决：联系管理员确认权限配置

**自查步骤**：
1. 确认是否登录正确的账号
2. 刷新页面或重新登录
3. 联系管理员检查权限配置

---

### 7.6 如何使用高级搜索？

**步骤**：
1. 在列表页找到"高级搜索"或"展开查询"按钮并点击
2. 页面展开更多查询条件
3. 根据需要填写多个条件：
   - 文本字段：输入关键字
   - 下拉字段：选择选项
   - 日期字段：选择日期范围
   - 数字字段：输入数值范围
4. 点击"查询"按钮执行搜索
5. 查看查询结果
6. 如需重新查询，点击"重置"清空条件

**技巧**：
- 多个条件之间通常是"且"关系（同时满足）
- 可以只填写部分条件
- 日期范围查询可以使用快捷选项（今天、本周、本月等）
- 查询结果可以直接导出

详见 [2.1.3 搜索与高级查询](#213-搜索与高级查询)

---

## 第8章 部署与运维

> 本章面向系统管理员，介绍如何部署和维护基于魔方开发的应用系统。

### 8.1 部署方式

#### 8.1.1 单机部署

**发布应用**：
```bash
dotnet publish -c Release -o ./publish
```

**发布文件清单**：
- `*.dll`：应用程序文件
- `*.exe`（Windows）或启动脚本
- `appsettings.json`：配置文件
- `wwwroot/`：静态资源目录
- `Views/`（MVC版）：视图文件

**运行应用**：
```bash
cd publish
dotnet YourApp.dll
```

**注意事项**：
- 确保目标服务器安装了对应版本的 .NET 运行时
- 首次运行会自动创建数据库和表结构
- 默认端口 5000（HTTP）和 5001（HTTPS）

#### 8.1.2 Windows 服务部署

使用 NewLife.Agent 可将应用注册为 Windows 服务：

**安装服务**：
```bash
YourApp.exe -i
```

**卸载服务**：
```bash
YourApp.exe -u
```

**服务管理**：
- 在"服务"管理器中找到应用服务
- 可设置自动启动
- 支持服务依赖配置

#### 8.1.3 Linux systemd 部署

创建服务配置文件 `/etc/systemd/system/yourapp.service`：

```ini
[Unit]
Description=YourApp Service
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/yourapp
ExecStart=/usr/bin/dotnet /opt/yourapp/YourApp.dll
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**启用并启动服务**：
```bash
sudo systemctl daemon-reload
sudo systemctl enable yourapp
sudo systemctl start yourapp
```

**查看服务状态**：
```bash
sudo systemctl status yourapp
```

#### 8.1.4 Docker 容器部署

**Dockerfile 示例**：
```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY publish/ .
EXPOSE 80
ENTRYPOINT ["dotnet", "YourApp.dll"]
```

**构建并运行**：
```bash
docker build -t yourapp .
docker run -d -p 8080:80 --name yourapp yourapp
```

**Docker Compose 示例**：
```yaml
version: '3'
services:
  app:
    image: yourapp
    ports:
      - "8080:80"
    volumes:
      - ./Data:/app/Data
      - ./Config:/app/Config
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
```

#### 8.1.5 集群部署

**无状态多实例**：
- 魔方应用设计为无状态，支持水平扩展
- 可使用 Nginx、HAProxy 等进行负载均衡

**共享资源**：
- 数据库：所有实例连接同一数据库
- 缓存：推荐使用 Redis 作为分布式缓存
- 文件存储：使用共享存储或对象存储

**负载均衡配置（Nginx示例）**：
```nginx
upstream yourapp {
    server 192.168.1.10:5000;
    server 192.168.1.11:5000;
    server 192.168.1.12:5000;
}

server {
    listen 80;
    location / {
        proxy_pass http://yourapp;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

### 8.2 SSO 用户中心部署

如果您的组织使用统一的用户中心（CubeSSO），以下是相关配置说明。

#### 8.2.1 CubeSSO 项目说明

CubeSSO 是基于魔方的统一认证中心，提供：
- 统一用户管理
- 单点登录（SSO）
- OAuth2.0 授权服务
- 多应用接入管理

#### 8.2.2 配置文件详解

关键配置项（`appsettings.json`）：
```json
{
  "ConnectionStrings": {
    "Membership": "Data Source=sso.db"
  },
  "CubeSetting": {
    "SysName": "用户中心",
    "DisplayName": "XX公司统一认证平台"
  },
  "OAuthSetting": {
    "JwtSecret": "your-secret-key-at-least-32-chars",
    "TokenExpire": 7200
  }
}
```

#### 8.2.3 首次启动与管理员

1. 首次启动系统会自动初始化数据库
2. 第一个访问系统的用户自动成为管理员
3. 管理员登录后建议：
   - 修改默认密码
   - 配置系统设置
   - 创建其它管理员账号

#### 8.2.4 关闭第三方登录

如不需要第三方登录，可在系统设置中：
1. 进入"系统管理" → "系统设置"
2. 找到"OAuth设置"部分
3. 禁用不需要的第三方登录方式
4. 或在配置文件中设置：
```json
{
  "OAuthSetting": {
    "EnableQQ": false,
    "EnableWeixin": false,
    "EnableDingTalk": false
  }
}
```

#### 8.2.5 系统名称修改

修改系统显示名称：
1. **管理后台修改**：系统设置 → 基础设置 → 系统名称
2. **配置文件修改**：
```json
{
  "CubeSetting": {
    "SysName": "您的系统名称",
    "DisplayName": "显示在登录页的名称"
  }
}
```

---

### 8.3 日常维护

#### 8.3.1 数据库备份

**自动备份**：
- 魔方内置定时作业支持自动备份数据库
- 在"系统管理" → "定时作业"中配置备份任务
- 支持备份到本地目录或远程存储

**手动备份**：
- SQLite：直接复制数据库文件
- MySQL/SQL Server：使用对应的备份工具

#### 8.3.2 日志管理

**日志位置**：
- 应用日志：`Log/` 目录
- 操作日志：数据库 `Log` 表

**日志清理**：
- 配置日志保留天数
- 使用内置的数据保留作业自动清理

#### 8.3.3 性能监控

**查看运行状态**：
- 访问首页可看到系统运行时间
- 性能监控页面显示内存、CPU等指标

**健康检查**：
- 访问 `/health` 端点检查服务状态

---

### 8.4 常见运维问题

#### 8.4.1 数据库驱动下载失败

**现象**：首次启动时无法连接数据库

**解决方案**：
1. 检查网络连接
2. 手动下载驱动放到 `Plugins/` 目录
3. 或使用 NuGet 添加对应的数据库驱动包

#### 8.4.2 端口被占用

**解决方案**：
1. 修改 `appsettings.json` 中的端口配置
2. 或使用命令行参数：
```bash
dotnet YourApp.dll --urls "http://*:8080"
```

#### 8.4.3 HTTPS 证书配置

**使用 Let's Encrypt 证书**：
1. 使用 Certbot 申请证书
2. 配置 Nginx 反向代理处理 HTTPS
3. 或在应用中直接配置证书

**配置示例**：
```json
{
  "Kestrel": {
    "Endpoints": {
      "Https": {
        "Url": "https://*:443",
        "Certificate": {
          "Path": "/path/to/cert.pfx",
          "Password": "cert-password"
        }
      }
    }
  }
}
```

---

## 附录：术语表

| 术语 | 说明 |
|------|------|
| **魔方** | NewLife.Cube快速开发平台 |
| **实体** | 数据库表对应的业务对象 |
| **列表页** | 显示数据列表的页面 |
| **表单页** | 添加或编辑数据的页面 |
| **详情页** | 查看数据完整信息的页面 |
| **CRUD** | 增加(Create)、读取(Read)、更新(Update)、删除(Delete)的缩写 |
| **OAuth** | 开放授权标准，用于第三方登录 |
| **SSO** | 单点登录(Single Sign-On)，一次登录多系统可用 |
| **JWT** | JSON Web Token，一种身份认证令牌 |
| **权限** | 用户能够执行的操作范围 |
| **角色** | 权限的集合 |
| **菜单** | 系统功能的导航入口 |
| **操作/Action** | 菜单下的具体功能（如查看、添加、编辑、删除） |
| **字段元数据** | 描述数据字段属性的信息（如名称、类型、是否必填等） |
| **分页** | 将大量数据分页显示，避免一次加载过多 |
| **过滤/筛选** | 根据条件缩小数据范围 |
| **排序** | 按某个字段升序或降序排列数据 |

---

## 附录：快捷键参考

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| Ctrl + S | 保存 | 在表单页保存数据（部分浏览器支持） |
| Esc | 取消/关闭 | 关闭弹出窗口或取消操作 |
| Enter | 提交/搜索 | 在搜索框按Enter执行搜索 |
| Ctrl + A | 全选 | 在某些列表中全选当前页 |

*注：快捷键支持情况取决于浏览器和具体界面实现*

---

## 结束语

本手册介绍了基于魔方快速开发平台构建的应用系统的通用功能和操作方法。您的系统可能包含特定业务功能，这些功能的使用方法请参考系统专用的业务操作手册。

如果在使用过程中遇到问题，请：
1. 查阅本手册相关章节
2. 联系系统管理员
3. 访问魔方在线教程：https://newlifex.com/cube

祝您使用愉快！

---

**文档版本**：v1.0  
**更新日期**：2025年  
**适用系统**：基于NewLife.Cube开发的应用系统  
